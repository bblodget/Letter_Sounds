<!--
Letter Sounds - An interactive web application for learning letter sounds
Copyright (C) 2024  Bob Blodget and Brandon Blodget

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Letter Sounds</title>
    <style>
        @font-face {
            font-family: 'DNealian';
            src: url('https://cdn.jsdelivr.net/gh/educatorstechnology/educational-fonts@master/DNealian/DNealian.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --bg: #ffffff;
            --fg: #000000;
            --font-size: clamp(4rem, 25vw + 1rem, 18rem);
            font-family: system-ui, sans-serif;
        }

        html,
        body {
            height: 100%;
            margin: 0;
        }

        body {
            display: grid;
            place-items: center;
            background: var(--bg);
            color: var(--fg);
        }

        #letter {
            font-size: var(--font-size);
            font-weight: 700;
            line-height: 1;
            user-select: none;
            pointer-events: none;
            font-family: 'DNealian', cursive;
            text-transform: lowercase;
        }

        #hint {
            position: fixed;
            bottom: 0.75rem;
            width: 100%;
            text-align: center;
            font-size: 1rem;
            opacity: .4;
        }
    </style>
</head>

<body>
    <div id="letter">press a key</div>
    <div id="hint">Alphabet keys A–Z trigger the sound • Esc clears</div>

    <script>
        /* -------------------------------------------
           Letter‑sound trainer – vanilla JS, no deps
           Works fully client‑side (static hosting OK)
           -----------------------------------------*/

        // Configure where your recordings live (optional)
        // Put 26 files named a.ogg … z.ogg inside /sounds/
        const SOUND_PATH = 'sounds/'      // ″sounds/" or "audio/" etc.
        const USE_TTS_FALLBACK = true       // speak if file missing

        // Cache <letter> → Audio objects at first use
        const audioCache = Object.create(null)

        // Vowel/consonant phonetic spellings for TTS (simple)
        const SPEAK_MAP = {
            A: 'ah', B: 'buh', C: 'kuh', D: 'duh', E: 'eh',
            F: 'fuh', G: 'guh', H: 'huh', I: 'ih', J: 'juh',
            L: 'luh', M: 'muh', N: 'nuh', O: 'oh', P: 'puh',
            Q: 'kwuh', R: 'ruh', S: 'sss', T: 'tuh', U: 'uh',
            V: 'vuh', W: 'wuh', X: 'ks', Y: 'yuh', Z: 'zzz'
        }

        const letterEl = document.getElementById('letter')

        window.addEventListener('keydown', async (e) => {
            // Ignore if key is longer than one char (e.g., Shift, ArrowLeft)
            if (e.key.length !== 1) {
                if (e.key === 'Escape') letterEl.textContent = ''
                return
            }
            const letter = e.key.toUpperCase()
            if (!/^[A-Z]$/.test(letter)) return

            // Display
            letterEl.textContent = letter.toLowerCase()

            // Play recorded audio if available, else TTS fallback
            try {
                await playLetter(letter)
            } catch (err) {
                console.error(err)
            }
        })

        async function playLetter(letter) {
            // Recorded sound first
            const path = `${SOUND_PATH}${letter.toLowerCase()}.ogg`
            let audio = audioCache[letter]
            if (!audio) {
                // Check if the file exists by attempting to fetch HEAD
                try {
                    const resp = await fetch(path, { method: 'HEAD' })
                    if (resp.ok) {
                        audio = new Audio(path)
                        audioCache[letter] = audio
                    }
                } catch (_) {
                    /* network/file missing */
                }
            }

            if (audio) {
                audio.currentTime = 0
                await audio.play()
                return
            }

            if (USE_TTS_FALLBACK && 'speechSynthesis' in window) {
                const utter = new SpeechSynthesisUtterance(SPEAK_MAP[letter] || letter)
                utter.rate = 0.8
                window.speechSynthesis.cancel() // stop any previous speech
                window.speechSynthesis.speak(utter)
            }
        }
    </script>
</body>

</html>