<!--
Letter Sounds - An interactive web application for learning letter sounds
Copyright (C) 2025  Bob Blodget and Brandon Blodget

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Letter Sounds</title>
    <style>
        @font-face {
            font-family: 'Andika';
            src: url('fonts/Andika-7.000/web/Andika-Regular.woff2') format('woff2'),
                url('fonts/Andika-7.000/web/Andika-Regular.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'Andika';
            src: url('fonts/Andika-7.000/web/Andika-Bold.woff2') format('woff2'),
                url('fonts/Andika-7.000/web/Andika-Bold.woff') format('woff');
            font-weight: bold;
            font-style: normal;
        }

        @font-face {
            font-family: 'Lexend';
            src: url('fonts/Lexend/static/Lexend-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'Lexend';
            src: url('fonts/Lexend/static/Lexend-Bold.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
        }

        @font-face {
            font-family: 'Teachers';
            src: url('fonts/Teachers/static/Teachers-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'Teachers';
            src: url('fonts/Teachers/static/Teachers-Bold.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
        }

        :root {
            --bg: #ffffff;
            --fg: #000000;
            --font-size: clamp(4rem, 25vw + 1rem, 18rem);
            font-family: var(--current-font, 'Andika'), system-ui, sans-serif;
        }

        html,
        body {
            height: 100%;
            margin: 0;
        }

        body {
            display: grid;
            place-items: center;
            background: var(--bg);
            color: var(--fg);
        }

        #letter {
            font-size: var(--font-size);
            font-weight: 700;
            line-height: 1;
            user-select: none;
            pointer-events: none;
            font-family: var(--current-font, 'Andika'), system-ui, sans-serif;
            text-transform: lowercase;
        }

        #hint {
            position: fixed;
            bottom: 0.75rem;
            width: 100%;
            text-align: center;
            font-size: 1rem;
            opacity: .4;
        }

        #font-selector {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        #font-selector:hover {
            border-color: #666;
        }

        .screen {
            display: none;
            position: fixed;
            inset: 0;
            place-items: center;
        }

        .screen.active {
            display: grid;
        }

        #home-screen {
            gap: 2rem;
        }

        #home-message {
            font-size: 2rem;
            text-align: center;
        }

        #letter-screen {
            display: none;
        }

        #letter-screen.active {
            display: grid;
        }
    </style>
</head>

<body>
    <div id="home-screen" class="screen active">
        <div id="home-message">press a key</div>
        <select id="font-selector">
            <option value="Andika">Andika</option>
            <option value="Lexend">Lexend</option>
            <option value="Teachers">Teachers</option>
        </select>
    </div>
    <div id="letter-screen" class="screen">
        <div id="letter"></div>
    </div>
    <div id="hint">Alphabet keys A–Z trigger the sound • Esc clears</div>

    <script>
        /* -------------------------------------------
           Letter‑sound trainer – vanilla JS, no deps
           Works fully client‑side (static hosting OK)
           -----------------------------------------*/

        // Configure where your recordings live (optional)
        // Put 26 files named a.ogg … z.ogg inside /sounds/
        const SOUND_PATH = 'sounds/'      // "sounds/" or "audio/" etc.
        const USE_TTS_FALLBACK = true       // speak if file missing

        // Cache <letter> → Audio objects at first use
        const audioCache = Object.create(null)

        // Vowel/consonant phonetic spellings for TTS (simple)
        const SPEAK_MAP = {
            A: 'ah', B: 'buh', C: 'kuh', D: 'duh', E: 'eh',
            F: 'fuh', G: 'guh', H: 'huh', I: 'ih', J: 'juh',
            K: 'kuh', L: 'luh', M: 'muh', N: 'nuh', O: 'oh', P: 'puh',
            Q: 'kwuh', R: 'ruh', S: 'sss', T: 'tuh', U: 'uh',
            V: 'vuh', W: 'wuh', X: 'ks', Y: 'yuh', Z: 'zzz'
        }

        const letterEl = document.getElementById('letter')
        const fontSelector = document.getElementById('font-selector')
        const homeScreen = document.getElementById('home-screen')
        const letterScreen = document.getElementById('letter-screen')

        // Load saved font preference
        const savedFont = localStorage.getItem('preferred-font')
        if (savedFont) {
            document.documentElement.style.setProperty('--current-font', savedFont)
            fontSelector.value = savedFont
        }

        // Handle font changes
        fontSelector.addEventListener('change', (e) => {
            const selectedFont = e.target.value
            document.documentElement.style.setProperty('--current-font', selectedFont)
            localStorage.setItem('preferred-font', selectedFont)
        })

        function showHomeScreen() {
            homeScreen.classList.add('active')
            letterScreen.classList.remove('active')
            letterEl.textContent = ''
        }

        function showLetterScreen() {
            homeScreen.classList.remove('active')
            letterScreen.classList.add('active')
        }

        window.addEventListener('keydown', async (e) => {
            // Handle Escape key
            if (e.key === 'Escape') {
                showHomeScreen()
                return
            }

            // Ignore if key is longer than one char (e.g., Shift, ArrowLeft)
            if (e.key.length !== 1) return

            const letter = e.key.toUpperCase()
            if (!/^[A-Z]$/.test(letter)) return

            // Show letter screen and display letter
            showLetterScreen()
            letterEl.textContent = letter.toLowerCase()

            // Play recorded audio if available, else TTS fallback
            try {
                // Add a small delay to ensure the screen transition is complete
                await new Promise(resolve => setTimeout(resolve, 50))
                await playLetter(letter)
            } catch (err) {
                console.error(err)
            }
        })

        async function playLetter(letter) {
            // Recorded sound first
            const path = `${SOUND_PATH}${letter.toLowerCase()}.ogg`
            let audio = audioCache[letter]
            if (!audio) {
                // Check if the file exists by attempting to fetch HEAD
                try {
                    const resp = await fetch(path, { method: 'HEAD' })
                    if (resp.ok) {
                        audio = new Audio(path)
                        audioCache[letter] = audio
                    }
                } catch (_) {
                    /* network/file missing */
                }
            }

            if (audio) {
                audio.currentTime = 0
                await audio.play()
                return
            }

            if (USE_TTS_FALLBACK && 'speechSynthesis' in window) {
                const utter = new SpeechSynthesisUtterance(SPEAK_MAP[letter] || letter)
                utter.rate = 0.8
                window.speechSynthesis.cancel() // stop any previous speech
                window.speechSynthesis.speak(utter)
            }
        }
    </script>
</body>

</html>